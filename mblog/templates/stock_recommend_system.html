{% extends "__base.html" %}
{% block content %}
<div class="row">
<div class="col-md-12">
  <div>
    <a id='sys1' class="btn btn-primary">System1</a>
    <a id='sys2' class="btn btn-primary">System2</a>
  </div>
<div id="total"></div>
<table class="table" id="turtle-system">
  <thead><tr><th>Break Time</th><th>Name</th><th>Code</th><th>Previous High</th><th>Break price</th>
                  <th>CV</th></tr></thead>
  <tbody></tbody>
</table>
</div>
</div>
{% endblock %}

{% block script %}
<script>
function fill_table_rows(resp){
  $('#total').text(resp.length);
  tbody = $('<tbody/>');
  for (var i = 0; i < resp.length; i++){
    tr = $('<tr/>');
    tr.append("<td>" + resp[i].break_time + "</td>");
    a_tag = $('<a/>');
    if(resp[i].code.substr(0, 2) === '60'){
      href = "http://finance.sina.com.cn/realstock/company/sh" + resp[i].code + "/nc.shtml";
    } else if(resp[i].code.substr(0, 2) === '30' || resp[i].code.substr(0, 2) === '00'){
      href = "http://finance.sina.com.cn/realstock/company/sz" + resp[i].code + "/nc.shtml";
    } else {
      href = 'http://quote.eastmoney.com/' + resp[i].code + '.html'
    }
    a_tag.attr('href', href);
    a_tag.attr('target', '_blank');
    a_tag.text(resp[i].name);
    td_tag = $('<td/>');
    td_tag.append(a_tag);
    tr.append(td_tag);
    tr.append("<td>" + resp[i].code + "</td>");
    tr.append("<td>" + resp[i].previous_highest_price + "</td>");
    tr.append("<td>" + resp[i].break_price + "</td>");
    tr.append("<td>" + resp[i].cv+ "</td>");
    tbody.append(tr);
  }
  $("#turtle-system").append(tbody);
  $("#loading").remove();
}
function load_system(sysnum){
  $('tbody').remove();
  insert_loading_after($("table"));
  $.ajax({
      method: "GET",
      url: "/data/tsystem/" + sysnum,
      success: fill_table_rows,
  });
}
$(function(){
  register_sort_fun();
  $('#sys1').click(function(){
          load_system('1');
          });
  $('#sys2').click(function(){
          load_system('2');
          });
}
)
</script>
{% endblock %}

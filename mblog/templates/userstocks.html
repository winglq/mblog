{% extends "__base.html" %}
{% block content %}
<div class="row">
  <div class="tool-bar">
    <a class="btn btn-primary" href="/user/stock/create">
            <i class="fa fa-plus" aria-hidden="true"></i> Create</a>
  </div>
  <div id="mystocks" class="col-md-12">
  </div>
</div>
{% endblock %}
{% block script %}
<script>
function delete_action(sid){
  $.ajax({
     method: "delete",
     url: "/data/stock?sid=" + sid,
     success: function(resp){
       console.log("reload page");
       location.reload();},
     error: function(resp){
       console.log("error");
       console.log(resp);
       location.reload();
     }
     });
}
function fill_table(resp){
  var ths = ["code", "hold_position", "bid_price", "stop_loss_price", "risk_percentage"];
  var cth = "actions";
  var rows = [];
  var btns = [];
  for(i = 0; i < resp.length; i++){
    var risk_perc = (resp[i]["bid_price"] - resp[i]["stop_loss_price"]) / resp[i]["bid_price"];
    risk_perc = risk_perc * 100;
    resp[i].risk_percentage = risk_perc.toFixed(2);
    row = [];
    for(j = 0; j < ths.length; j++){
      row.push(resp[i][ths[j]]);
    }
    rows.push(row);
    btn_row = [];
    btn_row.push(delete_control(resp[i]['id'], delete_action));
    btn_row.push(edit_control(resp[i]['id'], delete_action));
    btns.push(btn_row);
  }
  tb = put_data_in_table(ths, rows, cth, btns);
  $("#mystocks").append(tb);
}

$(function (){
  $.ajax({
    method: "GET",
    url: "/data/stock",
    success: fill_table})
})
</script>
{% endblock %}
